<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>QUIZ | Clube da Fenda</title>
    <link rel="stylesheet" href="SpongeboyRegular.woff2" as="font" type="font/woff2" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="quiz.css">
    <script src="/web-data-viz - clube da fenda/public/js/redirecionadores.js"></script>
</head>

<body>
    <header class="menu-lateral">
        <div class="logo">
          <div class="linha">
            <span class="letra" style="background-position: 0% 0%;">C</span>
            <span class="letra" style="background-position: 8% 0%;">l</span>
            <span class="letra" style="background-position: 16% 0%;">u</span>
            <span class="letra" style="background-position: 24% 0%;">b</span>
            <span class="letra" style="background-position: 32% 0%;">e</span>
            <span class="espaco"></span>
            <span class="letra" style="background-position: 48% 0%;">d</span>
            <span class="letra" style="background-position: 56% 0%;">a</span>
          </div>
          <div class="linha">
            <span class="letra" style="background-position: 72% 0%;">F</span>
            <span class="letra" style="background-position: 80% 0%;">e</span>
            <span class="letra" style="background-position: 88% 0%;">n</span>
            <span class="letra" style="background-position: 96% 0%;">d</span>
            <span class="letra" style="background-position: 104% 0%;">a</span>
          </div>
        </div>
    
        <nav role="navigation">
          <div class="hello">
            <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
          </div>
          <ul>
            <li id="dashboard">
              <span class="material-symbols-outlined">dashboard</span>
              <a href="/dashboard/overview.html">OVERVIEW</a>
            </li>
            <li class="ativo" aria-current="page" id="games">
              <span class="material-symbols-outlined">sports_esports</span>
              <a href="/dashboard/games.html">GAMES</a>
            </li>
            <li id="perfil">
                <span class="material-symbols-outlined">person</span>
                <a href="perfil.html">PERFIL</a>
              </li>
            <li id="sair">
              <span class="material-symbols-outlined">logout</span>
              <a onclick="limparSessao()">SAIR</a>
            </li>
          </ul>
        </nav>
      </header>

    <div id="tela-inicial" style="display: block;">
        <div id="titulo">
            <span class="letra" style="background-position: 0% 0%;">Q</span>
            <span class="letra" style="background-position: 8% 0%;">U</span>
            <span class="letra" style="background-position: 16% 0%;">I</span>
            <span class="letra" style="background-position: 24% 0%;">Z</span>
        </div>
        <h2>Responda corretamente as perguntas sobre o universo do Bob Esponja</h2>
        <div id="botao-iniciar">
            <button id="iniciar-quiz" onclick="iniciarQuiz()">Iniciar Quiz</button>
        </div>
    </div>

    <div id="tela-quiz" style="display: none;">
        <div id="quiz-container">
            <span class="numero-pergunta" id="numero-pergunta" style="background-position: 0% 0%;">1</span>
            <div class="pergunta" id="pergunta"></div>
            <div class="opcoes" id="opcoes"></div>
        </div>
    </div>

    <div id="tela-feedback" style="display: none;">
        <div id="resultado"></div>
        <button id="reiniciar-quiz" onclick="reiniciarQuiz()">Refazer Quiz</button>
        <button id="voltar-inicio" onclick="voltarInicio()">Tela inicial</button>
    </div>

</body>

</html>
<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    function iniciarQuiz() {
        document.getElementById("tela-inicial").style.display = "none";
        document.getElementById("tela-quiz").style.display = "flex";
    }

    const perguntas = [
        {
            pergunta: "Qual é o nome completo do Bob Esponja?",
            opcoes: ["Bob Esponja Calça-Quadrada", "Bob Quadrado Calça-Jeans", "Bob Marinho Calça-Longa", "Bob Água-Viva"],
            resposta: "Bob Esponja Calça-Quadrada"
        },
        {
            pergunta: "Qual é o nome do caracol de estimação do Bob Esponja?",
            opcoes: ["Larry", "Plankton", "Gary", "Perry"],
            resposta: "Gary"
        },
        {
            pergunta: "Qual é o nome do restaurante onde o Bob Esponja trabalha?",
            opcoes: [
                "Siri Grelhado",
                "Siri Cascudo",
                "Hamburguer do Mar",
                "Restaurante do Bob"
            ],
            resposta: "Siri Cascudo"
        },
        {
            pergunta: "Qual é o cargo do Bob Esponja no Siri Cascudo?",
            opcoes: [
                "Atendente",
                "Cozinheiro",
                "Gerente",
                "Segurança"
            ],
            resposta: "Cozinheiro"
        },
        {
            pergunta: " Quem é o dono do Siri Cascudo?",
            opcoes: [
                "Patrick",
                "Lula Molusco",
                "Sr. Siriguejo",
                "Plankton"
            ],
            resposta: "Sr. Siriguejo"
        },
        {
            pergunta: "Onde o Bob Esponja mora?",
            opcoes: [
                "Em uma âncora",
                "Em um abacaxi",
                "Em uma concha",
                "Em uma caravela"
            ],
            resposta: "Em um abacaxi"
        },
        {
            pergunta: "Qual personagem é mal-humorado e toca clarinete?",
            opcoes: [
                "Patrick",
                "Plankton",
                "Lula Molusco",
                "Larry"
            ],
            resposta: "Lula Molusco"
        },
        {
            pergunta: "Qual é o plano constante do Plankton?",
            opcoes: [
                "Encontrar uma água-viva lendária",
                "Roubar a fórmula do hambúrguer de siri",
                "Derrubar o Siri Cascudo",
                "Virar prefeito da Fenda do Biquíni"
            ],
            resposta: "Roubar a fórmula do hambúrguer de siri"
        },
        {
            pergunta: "Qual personagem veio do Texas?",
            opcoes: [
                "Karen",
                "Sandy",
                "Gary",
                "Pérola"
            ],
            resposta: "Sandy"
        },
        {
            pergunta: "O que o Bob Esponja ama fazer no tempo livre?",
            opcoes: [
                "Caçar baleias",
                "Correr maratonas",
                "Jogar futebol",
                "Caçar água-viva"
            ],
            resposta: "Caçar água-viva"
        }
    ];

    let perguntaAtual = 0;
    let pontuacao = 0;

    function mostrarPergunta() {
        const numeroPergunta = perguntaAtual + 1;
        document.getElementById("numero-pergunta").textContent = numeroPergunta;
        const p = perguntas[perguntaAtual];
        document.getElementById("pergunta").textContent = p.pergunta;

        const opcoesDiv = document.getElementById("opcoes");
        opcoesDiv.innerHTML = "";

        p.opcoes.forEach(opcoes => {
            const button = document.createElement("button");
            button.textContent = opcoes;
            button.onclick = () => checarResposta(opcoes);
            opcoesDiv.appendChild(button);
        });
    }

    function checarResposta(selecionada) {
        const correta = perguntas[perguntaAtual].resposta;
        const botoes = document.querySelectorAll("#opcoes button");

        botoes.forEach((botao) => {
            if (botao.textContent === correta) {
                botao.style.backgroundColor = "#5abf63";
            } else if (botao.textContent === selecionada) {
                botao.style.backgroundColor = "#eb5555";
            }
            botao.disabled = true;
        });

        if (selecionada === correta) {
            pontuacao++;
        }

        setTimeout(() => {
            perguntaAtual++;

            if (perguntaAtual < perguntas.length) {
                mostrarPergunta(); 
            } else {
                document.getElementById("tela-quiz").style.display = "none";
                document.getElementById("tela-feedback").style.display = "block";
                const resultadoDiv = document.getElementById("resultado");
                resultadoDiv.textContent = `Você acertou ${pontuacao} de ${perguntas.length} perguntas!`;

                cadastrar();
            }
        }, 1000); 
    }

    function cadastrar() {
        const dados = {
            idUserServer: sessionStorage.ID_USUARIO,
            pontuacaoQuizServer: pontuacao, 
        };

        console.log("Enviando dados para o servidor:", dados);

        fetch("/quiz/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(dados),
        })
            .then((resposta) => {
                if (resposta.ok) {
                    console.log("Pontuação enviada com sucesso!");
                    return resposta.json();
                } else {
                    throw new Error("Erro ao enviar a pontuação.");
                }
            })
            .then((dados) => {
                console.log("Resposta do servidor:", dados);
            })
            .catch((erro) => {
                console.error("Erro no envio:", erro);
            });
    }

    mostrarPergunta();

    function reiniciarQuiz() {
        perguntaAtual = 0;
        pontuacao = 0;
        document.getElementById("tela-feedback").style.display = "none";
        document.getElementById("tela-quiz").style.display = "flex";
        mostrarPergunta();
    }

    function voltarInicio() {
        perguntaAtual = 0;
        pontuacao = 0;
        document.getElementById("tela-feedback").style.display = "none";
        document.getElementById("tela-inicial").style.display = "block";
    }

    function limparSessao() {
    sessionStorage.clear();
    window.location = "/login.html";
}
   
</script>

