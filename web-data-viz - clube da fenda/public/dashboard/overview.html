<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clube da Fenda | Visão Geral</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link rel="stylesheet" href="./css-dashboard/overview.css" />
  <script src="../js/sessao.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body
  onload="validarSessao(); listarQuiz(); listarQuizPersonalidade(); listarPontuacaoGaryDoodle(); listarCruzadinha(); obterDados();">
  <header class="menu-lateral">
    <div class="logo">
      <div class="linha">
        <span class="letra" style="background-position: 0% 0%;">C</span>
        <span class="letra" style="background-position: 8% 0%;">l</span>
        <span class="letra" style="background-position: 16% 0%;">u</span>
        <span class="letra" style="background-position: 24% 0%;">b</span>
        <span class="letra" style="background-position: 32% 0%;">e</span>
        <span class="espaco"></span>
        <span class="letra" style="background-position: 48% 0%;">d</span>
        <span class="letra" style="background-position: 56% 0%;">a</span>
      </div>
      <div class="linha">
        <span class="letra" style="background-position: 72% 0%;">F</span>
        <span class="letra" style="background-position: 80% 0%;">e</span>
        <span class="letra" style="background-position: 88% 0%;">n</span>
        <span class="letra" style="background-position: 96% 0%;">d</span>
        <span class="letra" style="background-position: 104% 0%;">a</span>
      </div>
    </div>

    <nav role="navigation">
      <div class="hello">
        <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
      </div>
      <ul>
        <li class="ativo" aria-current="page" id="dashboard">
          <span class="material-symbols-outlined">dashboard</span>
          <a href="overview.html">OVERVIEW</a>
        </li>
        <li id="games">
          <span class="material-symbols-outlined">sports_esports</span>
          <a href="games.html">GAMES</a>
        </li>
        <li id="perfil">
          <span class="material-symbols-outlined">person</span>
          <a href="perfil.html">PERFIL</a>
        </li>
        <li id="sair">
          <span class="material-symbols-outlined">logout</span>
          <a onclick="limparSessao()">SAIR</a>
        </li>
      </ul>
    </nav>
  </header>

  <main class="main-overview">
    <div class="card">
      <!-- <img src="https://via.placeholder.com/300x150" alt="Imagem do card" class="card-img"> -->
      <div class="card-content">
        <h3>Maior pontuação no Quiz de Conhecimentos</h3>
        <div id="pontuacaoQuiz">Pontuação</div>
        <button onclick="jogarQuiz()">Jogar</button>
      </div>
    </div>
    <div class="card">
      <!-- <img src="https://via.placeholder.com/300x150" alt="Imagem do card" class="card-img"> -->
      <div class="card-content">
        <h3>Menor tempo na Cruzadinha</h3>
        <div id="tempoCruzadinha">Pontuação</div>
        <button onclick="jogarCruzadinha()">Jogar</button>
      </div>
    </div>
    <div class="card">
      <!-- <img src="https://via.placeholder.com/300x150" alt="Imagem do card" class="card-img"> -->
      <div class="card-content">
        <h3>Maior pontuação no Gary Doodle</h3>
        <div id="pontuacaoGaryDoodle">Pontuação</div>
        <button onclick="jogarGary()">Jogar</button>
      </div>
    </div>
    <div class="card">
      <!-- <img src="https://via.placeholder.com/300x150" alt="Imagem do card" class="card-img"> -->
      <div class="card-content">
        <h3>Quiz de Personalidade</h3>
        <h4>Você é :</h4>
        <div id="personagemQuizPersonalidade">Pontuação</div>
        <img id="resultado-imagem" src="" alt="Imagem do personagem" />
        <button onclick="jogarQuizPersonalidade()">Jogar</button>
      </div>
    </div>
    <div class="grafico">
      <!-- <img src="https://via.placeholder.com/300x150" alt="Imagem do card" class="card-img"> -->
      <div class="card-content">
        <h3>Jogos que você mais jogou</h3>
        <canvas id="meuGrafico"></canvas>
      </div>
    </div>
  </main>
</body>

</html>

<script src="../js/redirecionadores.js"></script>

<script>
  b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

function obterDados(){

    fetch('/jogosMaisJogados')
  .then(function(response){
    return response.json();
  })
  .then(function(data){
    plotarGraficoLinha(data);
    plotarGraficoBarra(data);
  })
  .catch(function(err){
    console.log(err);
  })

  const ctx = document.getElementById('meuGrafico').getContext('2d');

const meuGrafico = new Chart(ctx, {
    type: 'bar', // Tipo 'bar' para gráfico de colunas
    data: {
        labels: ['Quiz', 'Quiz Personalidade', 'Cruzadinha', 'Gary Doodle'], // Eixo X (categorias)
        datasets: [{
            label: 'Vendas (R$)',
            data: [1200, 1900, 3000, 500], // Eixo Y (valores)
            backgroundColor: [
                'rgba(75, 192, 192, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 206, 86, 0.5)',
                'rgba(255, 99, 132, 0.5)'
            ],
            borderColor: [
                'rgba(75, 192, 192, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(255, 99, 132, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true // Começa o eixo Y no zero
            }
        }
    }
});

}

  function limparSessao() {
    sessionStorage.clear();
    window.location = "/login.html";
  }

  function jogarQuiz(){
    window.location = "./Jogos/Quiz/quiz.html";
  }

  function jogarCruzadinha(){
    window.location = "./Jogos/Cruzadinha/cruzadinha.html";
  }

  function jogarGary(){
    window.location = "./Jogos/Gary_doodle/gary_doodle.html";
  }

  function jogarQuizPersonalidade(){
    window.location = "./Jogos/Quiz_personalidade/quizPersonalidade.html";
  }

  function listarQuiz() {
    const idUser = sessionStorage.ID_USUARIO;
    console.log("Enviando idUser para listarQuiz:", idUser);

    fetch(`/dash/listarQuiz?idUserServer=${idUser}`)
      .then(function (resposta) {
        if (resposta.ok) {
          if (resposta.status == 204) {
            document.getElementById("pontuacaoQuiz").innerHTML = `Você ainda não jogou o Quiz!`;
            return;
          }
          return resposta.json();
        } else {
          throw "Erro na resposta da API";
        }
      })
      .then(function (dados) {
        if (dados) {
          console.log("Dados recebidos: ", dados);
          // Atualize o conteúdo com os dados recebidos
          if (dados[0].pontuacaoQuiz == undefined) {
            document.getElementById("pontuacaoQuiz").innerHTML = `Você ainda não jogou o Quiz!`;
          } else {
            document.getElementById("pontuacaoQuiz").innerHTML = ` ${dados[0].pontuacaoQuiz}`;
          }
        }
      })
      .catch(function (erro) {
        console.error("Erro na requisição listarQuiz:", erro);
      });
  }

  function listarQuizPersonalidade() {
  const idUser = sessionStorage.ID_USUARIO;
  console.log("Enviando idUser para listarQuizPersonalidade:", idUser);

  fetch(`/dash/listarQuizPersonalidade?idUserServer=${idUser}`)
    .then(function (resposta) {
      if (resposta.ok) {
        if (resposta.status == 204) {
          document.getElementById("personagemQuizPersonalidade").innerHTML =
            `Você ainda não jogou o Quiz de Personalidade!`;
          return;
        }
        return resposta.json();
      } else {
        throw "Erro na resposta da API";
      }
    })
    .then(function (dados) {
      if (dados) {
        console.log("Dados recebidos: ", dados);

        const personagem = dados[0].personagem;

        if (!personagem) {
          document.getElementById("personagemQuizPersonalidade").innerHTML =
            `Você ainda não jogou o Quiz de Personalidade!`;
          return;
        }

        document.getElementById("personagemQuizPersonalidade").innerHTML = personagem;

        const imagens = {
          Bob: "./Jogos/Quiz_personalidade/assets/Personagens/bob_esponja.png",
          Patrick: "./Jogos/Quiz_personalidade/assets/Personagens/patrick.png",
          Siriguejo: "./Jogos/Quiz_personalidade/assets/Personagens/sr.sirigueijo.png",
          Plankton: "./Jogos/Quiz_personalidade/assets/Personagens/plankton.png",
          Sandy: "./Jogos/Quiz_personalidade/assets/Personagens/sandy.png",
          Lula: "./Jogos/Quiz_personalidade/assets/Personagens/lula_molusco.png"
        };

        const imagem = document.getElementById("resultado-imagem");

        if (imagens[personagem]) {
          imagem.src = imagens[personagem];
        }
      }
    })
    .catch(function (erro) {
      console.error("Erro na requisição listarQuizPersonalidade:", erro);
    });
}

  function listarPontuacaoGaryDoodle() {
    const idUser = sessionStorage.ID_USUARIO;
    console.log("Enviando idUser para listarPontuacaoGaryDoodle:", idUser);

    fetch(`/dash/listarPontuacaoGaryDoodle?idUserServer=${idUser}`)
      .then(function (resposta) {
        if (resposta.ok) {
          if (resposta.status == 204) {
            document.getElementById("pontuacaoGaryDoodle").innerHTML = `Você ainda não jogou o Gary Doodle!`;
            return;
          }
          return resposta.json();
        } else {
          throw "Erro na resposta da API";
        }
      })
      .then(function (dados) {
        if (dados) {
          console.log("Dados recebidos: ", dados);
          // Atualize o conteúdo com os dados recebidos
          if (dados[0].pontuacaoGary == undefined) {
            document.getElementById("pontuacaoGaryDoodle").innerHTML = `Você ainda não jogou o Gary Doodle!`;
          } else {
            document.getElementById("pontuacaoGaryDoodle").innerHTML = ` ${dados[0].pontuacaoGary}`;
          }
        }
      })
      .catch(function (erro) {
        console.error("Erro na requisição listarPontuacaoGaryDoodle:", erro);
      });
  }

  function listarCruzadinha() {
    const idUser = sessionStorage.ID_USUARIO;
    console.log("Enviando idUser para listarCruzadinha:", idUser);

    fetch(`/dash/listarCruzadinha?idUserServer=${idUser}`)
      .then(function (resposta) {
        if (resposta.ok) {
          if (resposta.status == 204) {
            document.getElementById("tempoCruzadinha").innerHTML = `Você ainda não jogou a Cruzadinha!`;
            return;
          }
          return resposta.json();
        } else {
          throw "Erro na resposta da API";
        }
      })
      .then(function (dados) {
        if (dados) {
          console.log("Dados recebidos: ", dados);
          // Atualize o conteúdo com os dados recebidos
          if (dados[0].tempoCruzadinha == undefined) {
            document.getElementById("tempoCruzadinha").innerHTML = `Você ainda não jogou a Cruzadinha!`;
          } else {
            const tempo = dados[0].tempoCruzadinha;

            const minutos = Math.floor(tempo / 60);
            const segundos = tempo % 60;

            const tempoFormatado = `${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;

            document.getElementById("tempoCruzadinha").innerHTML = `${tempoFormatado}`;
          }
        }
      })

      .catch(function (erro) {
        console.error("Erro na requisição listarCruzadinha:", erro);
      });
  }


</script>